import{__assign as t}from"tslib";import e,{useRef as o,useState as n,useCallback as r,useEffect as i,useMemo as l}from"react";import{useEditor as a,EditorContent as d}from"@tiptap/react";import s from"@tiptap/starter-kit";import u from"@tiptap/extension-superscript";import c from"@tiptap/extension-subscript";import m from"@tiptap/extension-link";import f from"@tiptap/extension-highlight";import p from"@tiptap/extension-placeholder";import{cssDecorator as h}from"@front-toolkit/utils";import{useContextMenu as v}from"@front-toolkit/hooks";import g from"./utils/PastedTextFormatter.js";import C from"./Controls/index.js";import E from"./AddLinkTooltip/index.js";import{EditorContext as x}from"./EditorContext.js";import k from"./EditorControls/AddLinkButton.js";import b from"./EditorControls/CopyCutPasteButtons.js";import j from"./EditorControls/ClearAllButton.js";import w from"./EditorControls/FormatFontButton.js";import B from"./EditorControls/FormatListButton.js";import L from"./EditorControls/UndoRedoButtons.js";import{EditorContextMenu as A}from"./EditorContextMenu/index.js";import{TOOLTIP_INITIAL_STATE as T,TEXT_EDITOR_WITH_BORDER_HEIGHT as P,CONTROLS_HEIGHT as R}from"./constants.js";import y from"./TextEditor.module.scss.js";var D=h(y),F=function(h){var F,H=h.content,M=h.format,N=h.controls,U=h.withBorder,O=h.dataTestId,S=h.height,_=h.setContent,W=h.setTextContent,G=h.forceUpdateWithValue,I=h.disabled,J=void 0!==I&&I,V=h.placeholder,X=void 0===V?"":V,Y=h.children,q=o(null),z=o(null),K=a({editorProps:{transformPastedHTML:function(t){return g(t,N)}},extensions:[s.configure({history:{depth:5,newGroupDelay:400}}),u,c,m.configure({openOnClick:!1,autolink:!1}),f.configure({multicolor:!0}),p.configure({placeholder:X,emptyEditorClass:y.placeholder})],autofocus:"end",content:H,onUpdate:function(t){var e="html"===M?t.editor.getHTML():t.editor.getJSON().content;_(e),W&&W(t.editor.getText())},enablePasteRules:(null==N?void 0:N.formatLink)?[m]:[]}),Q=n(T),Z=Q[0],$=Q[1],tt=n(""),et=tt[0],ot=tt[1],nt=n(T),rt=nt[0],it=nt[1],lt=r((function(){var t,e=window.getSelection();if((null==e?void 0:e.toString())||(null==K?void 0:K.isActive("link"))){var o=null==K?void 0:K.getAttributes("link").href;o&&ot(o);var n=null===(t=q.current)||void 0===t?void 0:t.getBoundingClientRect(),r=null==e?void 0:e.getRangeAt(0).getBoundingClientRect();if(n&&r){var i=r.top-n.top+r.height,l=r.left-n.left,a=n.right-n.left-300-12;$({show:!0,top:i,left:l>a?a:l}),null==K||K.commands.setHighlight({color:"rgba(18 32 144 / 10%)"})}}}),[K]),at=r((function(){$(T),ot(""),null==K||K.chain().focus().undo().run()}),[K]),dt=r((function(t){at(),null==K||K.chain().focus().extendMarkRange("link").setLink({href:t}).run()}),[K,at]),st=r((function(e){var o;if((null==K?void 0:K.isActive("link"))&&K.isFocused){e.preventDefault();var n=null==K?void 0:K.getAttributes("link").href,r=null===(o=q.current)||void 0===o?void 0:o.getBoundingClientRect();if(r){var i=e.clientY-r.top,l=e.clientX-r.left,a=r.right-r.left-300-12,d=l>a?a:l;ot(n),it({show:!0,top:i,left:d}),$((function(e){return t(t({},e),{top:i,left:d})}))}}}),[K]);v(q,st),i((function(){var t=q.current;t&&K&&t.append(K.options.element)}),[K]),i((function(){void 0!==G&&(null==K||K.commands.setContent(G))}),[null==K?void 0:K.commands,G]),i((function(){null==K||K.setOptions({editable:!J})}),[K,J]);var ut=D("editor",((F={})[U?"with_border":"without_border"]=!0,F.disabled=J,F)),ct=l((function(){return{editor:K,disabled:J}}),[K,J]);return e.createElement("div",{className:U?y.wrapper:"",style:{height:function(){var t,e=0;return S&&(e+=S+R,(null===(t=z.current)||void 0===t?void 0:t.clientHeight)&&(e+=z.current.clientHeight)),e||void 0}()},"data-test-id":O},e.createElement(x.Provider,{value:ct},e.createElement(C,{widePanel:!U},e.createElement(L,null),e.createElement(b,{controls:N}),e.createElement(w,{hidden:!(null==N?void 0:N.formatFont)}),e.createElement(B,{hidden:!(null==N?void 0:N.formatList)}),e.createElement(k,{hidden:!(null==N?void 0:N.formatLink),onClick:lt}),e.createElement(j,{hidden:!(null==N?void 0:N.clearAllButton)}))),Y&&e.createElement("div",{className:U?"":y.childrenWide,ref:z},Y),e.createElement(d,{editor:K,className:ut,style:{"--ds-text-editor-with-border-height":S?S+"px":z.current&&U?P-z.current.clientHeight+"px":U?P+"px":""}}),e.createElement("div",{ref:q,className:y.editor_root},Z.show&&e.createElement(E,{onClose:at,onConfirm:dt,url:et,position:{top:Z.top,left:Z.left}}),rt.show&&e.createElement(x.Provider,{value:ct},e.createElement(A,{contextMenuData:rt,currentLinkUrl:et,resetContextData:function(){it(T),ot("")},setContextMenuData:it,setLinkTooltipData:$}))))};export{F as TextEditor};
//# sourceMappingURL=index.js.map
