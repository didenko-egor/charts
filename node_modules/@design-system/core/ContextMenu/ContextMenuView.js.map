{"version":3,"file":"ContextMenuView.js","sources":["../../src/ContextMenu/ContextMenuView.tsx"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  createRef,\n  ReactElement,\n  cloneElement,\n  Children,\n  useRef\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport { v4 as uuid } from 'uuid';\n\nimport {\n  MenuSize,\n  ItemProps,\n  ContextMenuViewProps,\n  MenuPosition\n} from './types';\nimport ContextMenuProvider from './ContextMenuProvider';\nimport { useClickOutsideMenu } from './utils/useClickOutsideMenu';\nimport { calculateMenuPosition } from './utils/position';\nimport { recursiveMap } from './utils/recursiveMap';\nimport Menu from './Menu';\nimport Item from './Menu/Item';\n\ninterface CloneElementProps {\n  /** Элементы меню */\n  children: ReactElement[];\n\n  /** Размер меню */\n  size: MenuSize;\n\n  /** Метка меню для определения принадлежности подменю */\n  menuStamp?: string;\n\n  /** Колбэк для закрытия меню */\n  onClose?: VoidFunction;\n}\n\n/** Клонирование меню */\nfunction cloneMenuWithProps(\n  {\n    size,\n    menuStamp\n  }: CloneElementProps,\n  el: ReactElement\n): ReactElement {\n  const withIcons = el.props.children.some((child: ReactElement<ItemProps>) => child.props.Icon);\n\n  const menuId = uuid();\n\n  return cloneElement(\n    el,\n    { size, menuStamp },\n    Children.map(\n      el.props.children,\n      (child: ReactElement) => (cloneElement(child, { withIcons, menuId }))\n    )\n  );\n}\n\n/** Клонирование элементов меню */\nfunction cloneItemWithProps(\n  {\n    children,\n    size,\n    onClose\n  }: CloneElementProps,\n  el: ReactElement\n): ReactElement {\n  const withIcons = children.some((child: ReactElement<ItemProps>) => child.props.Icon);\n\n  const newItemProps: ItemProps = {\n    size,\n    id: uuid(),\n    withIcons,\n    withSubmenu: Boolean(el.props.children)\n  };\n\n  if (!newItemProps.withSubmenu) {\n    if (el.props.onClick) {\n      newItemProps.onClick = (): void => {\n        el.props.onClick();\n        if (onClose) {\n          onClose();\n        }\n      };\n    }\n\n    if (el.props.onMouseDown) {\n      newItemProps.onMouseDown = (): void => {\n        el.props.onMouseDown();\n        if (onClose) {\n          onClose();\n        }\n      };\n    }\n  }\n\n  return cloneElement(el, newItemProps);\n}\n\n/** Создать копию дочерних элементов и задать для них пропсы */\nfunction cloneElementWithProps(\n  props: CloneElementProps,\n  el: ReactElement\n): ReactElement {\n  if (el.type === Menu) {\n    return cloneMenuWithProps(props, el);\n  }\n\n  if (el.type === Item) {\n    return cloneItemWithProps(props, el);\n  }\n\n  return cloneElement(el);\n}\n\n/** Компонент для отображения содержимого контекстного меню */\nexport function ContextMenuView({\n  size = 'default',\n  mousePosition,\n  onClose,\n  children\n}: ContextMenuViewProps): JSX.Element | null {\n  const menuRef = createRef<HTMLUListElement>();\n  const [menuPosition, setMenuPosition] = useState<MenuPosition | undefined>(undefined);\n\n  const menuStamp = useRef(Date.now().toString());\n\n  useClickOutsideMenu(menuStamp.current, onClose);\n\n  useEffect(() => {\n    if (mousePosition && menuRef.current && !menuPosition) {\n      /** 16 - это padding сверху и снизу */\n      const menuHeight = size === 'default' ? children.length * 44 + 16 : children.length * 40;\n      const calculatedMenuPosition = calculateMenuPosition(menuRef.current, mousePosition, menuHeight);\n\n      setMenuPosition(calculatedMenuPosition);\n    }\n\n    return () => {\n      if (menuPosition) {\n        setMenuPosition(undefined);\n      }\n    };\n  }, [mousePosition, menuRef, menuPosition, size, children.length]);\n\n  if (!mousePosition) return null;\n\n  const cloneElementWithPropsBind = cloneElementWithProps.bind(null, {\n    children,\n    size,\n    menuStamp: menuStamp.current,\n    onClose,\n    menuType: Menu,\n    itemType: Item\n  });\n\n  return createPortal(\n    <ContextMenuProvider>\n      <Menu\n        ref={ menuRef }\n        size={ size }\n        menuPosition={ menuPosition }\n        menuStamp={ menuStamp.current }\n      >\n        { recursiveMap(children, cloneElementWithPropsBind) }\n      </Menu>\n    </ContextMenuProvider>,\n    document.body\n  );\n}\n"],"names":["cloneElementWithProps","props","el","type","Menu","_a","size","menuStamp","withIcons","children","some","child","Icon","menuId","uuid","cloneElement","Children","map","cloneMenuWithProps","Item","onClose","newItemProps","id","withSubmenu","Boolean","onClick","onMouseDown","cloneItemWithProps","ContextMenuView","_b","mousePosition","menuRef","createRef","_c","useState","undefined","menuPosition","setMenuPosition","useRef","Date","now","toString","useClickOutsideMenu","current","useEffect","menuHeight","length","calculatedMenuPosition","calculateMenuPosition","cloneElementWithPropsBind","bind","menuType","itemType","createPortal","React","ContextMenuProvider","ref","recursiveMap","document","body"],"mappings":"odAuGA,SAASA,EACPC,EACAC,GAEA,OAAIA,EAAGC,OAASC,EAnElB,SACEC,EAIAH,OAHEI,SACAC,cAIIC,EAAYN,EAAGD,MAAMQ,SAASC,MAAK,SAACC,GAAmC,OAAAA,EAAMV,MAAMW,QAEnFC,EAASC,IAEf,OAAOC,EACLb,EACA,CAAEI,OAAMC,aACRS,EAASC,IACPf,EAAGD,MAAMQ,UACT,SAACE,GAAwB,OAACI,EAAaJ,EAAO,CAAEH,YAAWK,cAGjE,CAiDWK,CAAmBjB,EAAOC,GAG/BA,EAAGC,OAASgB,EAjDlB,SACEd,EAKAH,OAJEO,aACAH,SACAc,YAIIZ,EAAYC,EAASC,MAAK,SAACC,GAAmC,OAAAA,EAAMV,MAAMW,QAE1ES,EAA0B,CAC9Bf,OACAgB,GAAIR,IACJN,YACAe,YAAaC,QAAQtB,EAAGD,MAAMQ,WAuBhC,OApBKY,EAAaE,cACZrB,EAAGD,MAAMwB,UACXJ,EAAaI,QAAU,WACrBvB,EAAGD,MAAMwB,UACLL,GACFA,MAKFlB,EAAGD,MAAMyB,cACXL,EAAaK,YAAc,WACzBxB,EAAGD,MAAMyB,cACLN,GACFA,OAMDL,EAAab,EAAImB,EAC1B,CAYWM,CAAmB1B,EAAOC,GAG5Ba,EAAab,EACtB,UAGgB0B,EAAgBvB,OAC9BwB,SAAAvB,aAAO,YACPwB,kBACAV,YACAX,aAEMsB,EAAUC,IACVC,EAAkCC,OAAmCC,GAApEC,OAAcC,OAEf9B,EAAY+B,EAAOC,KAAKC,MAAMC,YAoBpC,GAlBAC,EAAoBnC,EAAUoC,QAASvB,GAEvCwB,GAAU,WACR,GAAId,GAAiBC,EAAQY,UAAYP,EAAc,CAErD,IAAMS,EAAsB,YAATvC,EAAuC,GAAlBG,EAASqC,OAAc,GAAuB,GAAlBrC,EAASqC,OACvEC,EAAyBC,EAAsBjB,EAAQY,QAASb,EAAee,GAErFR,EAAgBU,GAGlB,OAAO,WACDX,GACFC,OAAgBF,MAGnB,CAACL,EAAeC,EAASK,EAAc9B,EAAMG,EAASqC,UAEpDhB,EAAe,OAAO,KAE3B,IAAMmB,EAA4BjD,EAAsBkD,KAAK,KAAM,CACjEzC,WACAH,OACAC,UAAWA,EAAUoC,QACrBvB,UACA+B,SAAU/C,EACVgD,SAAUjC,IAGZ,OAAOkC,EACLC,gBAACC,OACCD,gBAAClD,GACCoD,IAAMzB,EACNzB,KAAOA,EACP8B,aAAeA,EACf7B,UAAYA,EAAUoC,SAEpBc,EAAahD,EAAUwC,KAG7BS,SAASC,KAEb"}