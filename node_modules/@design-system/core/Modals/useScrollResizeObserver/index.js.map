{"version":3,"file":"index.js","sources":["../../../src/Modals/useScrollResizeObserver/index.ts"],"sourcesContent":["import {\n  CSSProperties,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState\n} from 'react';\n\nimport styles from './styles.scss';\n\ntype SetInnerWrapperRef = (current: HTMLDivElement) => void;\n\n// При использовании в компоненте добавлять предупреждение про полифиллы (см в существующих)\ntype UseScrollObserver = (componentScrollParentClassName?: string) => ({\n  setInnerWrapperRef: SetInnerWrapperRef;\n  scrollBoxWidth?: number;\n  scrollParentStyle?: CSSProperties;\n  scrollParentClassName?: string;\n  overrideScrollBoxClassName?: string;\n});\n\nconst mutationObserverOptions = { childList: true, subtree: true };\nexport const useScrollResizeObserver: UseScrollObserver = componentScrollParentClassName => {\n  const contentWrapperRef = useRef<HTMLDivElement>();\n\n  const [mutationObserver, setMutationObserver] = useState<MutationObserver | null>(null);\n  const [resizeObserver, setResizeObserver] = useState<ResizeObserver | null>(null);\n  const [width, setWidth] = useState<number | undefined>();\n  const [height, setHeight] = useState<number | undefined>();\n\n  const scrollParentStyle = useMemo(() => (height\n    ? { '--ds-modal-content-height': `${ height }px` } as CSSProperties\n    : undefined\n  ), [height]);\n\n  const scrollParentClassName = [styles.scroll_parent, componentScrollParentClassName].filter(Boolean).join(' ');\n\n  const onResize = (): void => {\n    const { current } = contentWrapperRef;\n\n    if (current?.isConnected) {\n      const { offsetWidth, offsetHeight, scrollHeight } = current;\n      const heightFix = scrollHeight > offsetHeight ? 10 : 0;\n\n      setWidth(offsetWidth);\n      setHeight(scrollHeight + heightFix);\n    }\n  };\n\n  const setInnerWrapperRef = useCallback<SetInnerWrapperRef>(current => {\n    const { current: oldNode } = contentWrapperRef;\n\n    if (current !== oldNode) {\n      contentWrapperRef.current = current;\n\n      resizeObserver?.disconnect();\n      mutationObserver?.disconnect();\n\n      if (current?.isConnected) {\n        resizeObserver?.observe(current);\n        mutationObserver?.observe(current, mutationObserverOptions);\n\n        onResize();\n      }\n    }\n  }, [mutationObserver, resizeObserver]);\n\n  useEffect((): VoidFunction | undefined => {\n    const newMutationObserver = new MutationObserver(onResize);\n    const newResizeObserver = new ResizeObserver(onResize);\n\n    setMutationObserver(newMutationObserver);\n    setResizeObserver(newResizeObserver);\n\n    return (): void => {\n      newResizeObserver?.disconnect();\n      newMutationObserver?.disconnect();\n    };\n  }, []);\n\n  return {\n    setInnerWrapperRef,\n    scrollBoxWidth: width,\n    scrollParentStyle,\n    scrollParentClassName,\n    overrideScrollBoxClassName: styles.scroll\n  };\n};\n"],"names":["mutationObserverOptions","childList","subtree","useScrollResizeObserver","componentScrollParentClassName","contentWrapperRef","useRef","_a","useState","mutationObserver","setMutationObserver","_b","resizeObserver","setResizeObserver","_c","width","setWidth","_d","height","setHeight","scrollParentStyle","useMemo","undefined","scrollParentClassName","styles","scroll_parent","filter","Boolean","join","onResize","current","isConnected","offsetWidth","offsetHeight","scrollHeight","heightFix","setInnerWrapperRef","useCallback","disconnect","observe","useEffect","newMutationObserver","MutationObserver","newResizeObserver","ResizeObserver","scrollBoxWidth","overrideScrollBoxClassName","scroll"],"mappings":"0HAsBA,IAAMA,EAA0B,CAAEC,WAAW,EAAMC,SAAS,GAC/CC,EAA6C,SAAAC,GACxD,IAAMC,EAAoBC,IAEpBC,EAA0CC,EAAkC,MAA3EC,OAAkBC,OACnBC,EAAsCH,EAAgC,MAArEI,OAAgBC,OACjBC,EAAoBN,IAAnBO,OAAOC,OACRC,EAAsBT,IAArBU,OAAQC,OAETC,EAAoBC,GAAQ,WAAM,OAACH,EACrC,CAAE,4BAAiCA,aACnCI,IACD,CAACJ,IAEEK,EAAwB,CAACC,EAAOC,cAAerB,GAAgCsB,OAAOC,SAASC,KAAK,KAEpGC,EAAW,WACP,IAAAC,EAAYzB,UAEpB,GAAIyB,eAAAA,EAASC,YAAa,CAChB,IAAAC,EAA4CF,cAA/BG,EAA+BH,eAAjBI,EAAiBJ,eAC9CK,EAAYD,EAAeD,EAAe,GAAK,EAErDjB,EAASgB,GACTb,EAAUe,EAAeC,KAIvBC,EAAqBC,GAAgC,SAAAP,GAGrDA,IAFyBzB,YAG3BA,EAAkByB,QAAUA,EAE5BlB,SAAAA,EAAgB0B,aAChB7B,SAAAA,EAAkB6B,cAEdR,eAAAA,EAASC,eACXnB,SAAAA,EAAgB2B,QAAQT,GACxBrB,SAAAA,EAAkB8B,QAAQT,EAAS9B,GAEnC6B,QAGH,CAACpB,EAAkBG,IAetB,OAbA4B,GAAU,WACR,IAAMC,EAAsB,IAAIC,iBAAiBb,GAC3Cc,EAAoB,IAAIC,eAAef,GAK7C,OAHAnB,EAAoB+B,GACpB5B,EAAkB8B,GAEX,WACLA,SAAAA,EAAmBL,aACnBG,SAAAA,EAAqBH,gBAEtB,IAEI,CACLF,qBACAS,eAAgB9B,EAChBK,oBACAG,wBACAuB,2BAA4BtB,EAAOuB,OAEvC"}