import{__spreadArray as e}from"tslib";import t,{useRef as n,useMemo as r,useState as i,useCallback as o,useEffect as s}from"react";import a from"lodash.debounce";import{v4 as l}from"uuid";import u from"../utils/xorSelectItem/index.js";import c from"../utils/getUniqueSelectItems/index.js";import"../packages/core/shared/InputHint/index.js";import"../packages/core/shared/InputLabel/index.js";import{BaseSelect as d}from"../packages/core/shared/BaseSelect/index.js";import{BaseInput as m}from"../shared/BaseInput/index.js";import{useFormContext as f}from"../shared/Form/formContext.js";import{Mark as p}from"../Mark/index.js";import{FieldWrapper as b}from"../FieldWrapper/index.js";import v from"../shared/BaseInput/coreStyles.scss.js";import h from"../shared/BaseInput/WithIcons/coreStyles.scss.js";import{IconPlus as I}from"../icons/index.js";import j from"./styles.scss.js";var x={},g=function(g){var S=g.id,C=g.label,E=g.disabled,y=g.labelAside,L=g.labelWidth,k=g.fieldName,A=g.size,B=void 0===A?"default":A,W=g.dataTestId,_=void 0===W?"async_tag_select_id":W,w=g.defaultSelectedItems,z=void 0===w?[]:w,D=g.onAsyncChange,T=g.onSelectedItemsChange,F=f({labelWidth:L,labelAside:y,size:B}),H=F.LABEL_WIDTH,N=F.LABEL_ASIDE,q=F.SIZE,M=n(null),O=n(!1),R=r((function(){return e([],z,!0).sort((function(e,t){return e.disabled===t.disabled?0:e.disabled?-1:1}))}),[z]),U=i(!1),V=U[0],Z=U[1],G=i(""),J=G[0],K=G[1],P=i(!1),Q=P[0],X=P[1],Y=i(!1),$=Y[0],ee=Y[1],te=i(R),ne=te[0],re=te[1],ie=i([]),oe=ie[0],se=ie[1],ae=i(R),le=ae[0],ue=ae[1],ce=i(!1),de=ce[0],me=ce[1],fe=o((function(){Z(!1),X(!1),ee(!1)}),[]),pe=o((function(e){var t=ne.find((function(t){return t.value===e}));ue((function(e){return u(e,t)})),K(""),fe()}),[ne,fe]),be=r((function(){return!!J.trim()&&!ne.find((function(e){return e.label===J.trim()}))}),[ne,J]),ve=r((function(){return a((function(e){D(e).then((function(e){re(c(e,R).concat(oe)),me(!1)})).catch((function(){me(!1)}))}),500)}),[oe,R,D]),he=o((function(e){K(e),e.trim()&&(X(!0),Z(!0),me(!0),ve(e.trim()))}),[ve]),Ie=o((function(){J.trim()&&(X(!0),Z(!0),me(!0),ve(J.trim()))}),[ve,J]),je=o((function(){re(oe),fe()}),[oe,fe]),xe=o((function(){var t,n={label:J.trim(),value:l()};ue((function(t){return e(e([],t,!0),[n],!1)})),re((function(t){return e(e([],t,!0),[n],!1)})),se((function(t){return e(e([],t,!0),[n],!1)})),K(""),fe(),null===(t=M.current)||void 0===t||t.focus()}),[J,fe]),ge=o((function(e){return function(){ue((function(t){return t.filter((function(t){return t.value!==e}))}))}}),[]),Se=r((function(){return[{icon:t.createElement(I,null),onClick:xe}]}),[xe]),Ce=r((function(){return le.map((function(e){return e.value}))}),[le]),Ee=r((function(){return ne.filter((function(e){var t=J.trim();return e.label.toLowerCase().slice(0,t.length)===t.toLowerCase()}))}),[J,ne]);return s((function(){O.current?T(le.map((function(e){return e.label})),k):O.current=!0}),[le,k,T]),s((function(){J?de||ee(be):fe()}),[J,fe,be,de]),t.createElement(b,{id:S,dataTestId:_,size:q,disabled:E,label:C,labelAside:N,labelWidth:H},t.createElement(d,{size:q,activeValue:Ce,isLoading:de,items:Q?Ee:ne,isOpenDropdown:V,onItemClick:pe,onCloseDropdown:je},t.createElement(m,{id:S,inputRef:M,disabled:E,onChange:he,onFocus:Ie,placeholder:"",value:J,icons:$?Se:void 0,styles:v,iconsStyles:h,wrapperStyles:x})),t.createElement("div",{className:j.tags},le.map((function(e){return t.createElement(p,{key:e.value,text:e.label,onClose:e.disabled?void 0:ge(e.value),disabled:E,size:q,dataTestId:"selected_tag"})}))))};export{g as AsyncTagSelect};
//# sourceMappingURL=index.js.map
