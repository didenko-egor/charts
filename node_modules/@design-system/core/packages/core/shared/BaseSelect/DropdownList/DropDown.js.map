{"version":3,"file":"DropDown.js","sources":["../../../../../../shared/BaseSelect/DropdownList/DropDown.tsx"],"sourcesContent":["import React, {\n  CSSProperties,\n  useCallback,\n  useEffect,\n  useRef,\n  useState\n} from 'react';\nimport { createPortal } from 'react-dom';\n\nimport styles from './styles.scss';\n\nexport interface DropdownListProps {\n  /** Флаг открытия или закрытия выпадающего меню */\n  isOpen: boolean;\n\n  /** Включение режима fixed ( + идентификатор выпадающего списка) */\n  fixedModeID?: string;\n}\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nconst FixedDropDown: React.FC<{ fixedModeID: string }> = ({ fixedModeID, children }) => {\n  const [dropDownStyle, setDropDownStyle] = useState<CSSProperties>();\n  const [portalContainerNode, setPortalContainer] = useState<HTMLElement>();\n  const [scrollableAncestors, setScrollableAncestors] = useState<HTMLElement[]>([]);\n  const trackerElemRef = useRef<HTMLElement | null>(null);\n  const [trackerElem, setTrackerElem] = useState<HTMLElement | null>(null);\n  const [resizeObserver, setResizeObserver] = useState<ResizeObserver | null>(null);\n\n  const onResize = useCallback(() => {\n    const tracker = trackerElemRef.current;\n    if (tracker) {\n      const { top, left, width } = tracker.getBoundingClientRect();\n      setDropDownStyle({\n        position: 'fixed',\n        top,\n        left,\n        width\n      } as CSSProperties);\n    }\n  }, []);\n\n  const trackerRefCallback = useCallback((elem: HTMLElement | null) => {\n    setTrackerElem(elem);\n    trackerElemRef.current = elem || null;\n\n    if (elem?.isConnected) {\n      const ancestors: HTMLElement[] = [];\n      let ancestor: HTMLElement | null = elem;\n      let loopLimit = 10000;\n\n      while (ancestor && loopLimit) {\n        loopLimit -= 1;\n        ancestor = ancestor.parentElement;\n\n        if (ancestor === document.body) {\n          ancestor = null;\n        } else if (ancestor?.matches('.simplebar-content-wrapper, [data-has-scroll]')) {\n          ancestors.push(ancestor);\n        }\n      }\n\n      setScrollableAncestors(ancestors);\n    }\n\n    if (resizeObserver && elem) {\n      resizeObserver.observe(elem);\n    }\n  }, [resizeObserver]);\n\n  useEffect(() => {\n    if (resizeObserver && trackerElem) {\n      resizeObserver.observe(trackerElem);\n\n      return (): void => resizeObserver.unobserve(trackerElem);\n    }\n\n    return undefined;\n  }, [resizeObserver, trackerElem]);\n\n  useEffect(() => {\n    window.addEventListener('scroll', onResize);\n    window.addEventListener('resize', onResize);\n    scrollableAncestors.forEach(ancestor => {\n      ancestor.addEventListener('scroll', onResize);\n\n      if (resizeObserver) { resizeObserver.observe(ancestor); }\n    });\n\n    return (): void => {\n      window.removeEventListener('scroll', onResize);\n      window.removeEventListener('resize', onResize);\n      scrollableAncestors.forEach(ancestor => {\n        ancestor.removeEventListener('scroll', onResize);\n\n        if (resizeObserver) { resizeObserver.unobserve(ancestor); }\n      });\n    };\n  }, [onResize, resizeObserver, scrollableAncestors]);\n\n  useEffect(() => {\n    const observer = new ResizeObserver(onResize);\n\n    setResizeObserver(observer);\n    setPortalContainer(document.body);\n\n    return (): void => (observer.disconnect());\n  }, [onResize]);\n\n  // фикс навигации табами для fixedMode режима\n  const onFocusTracker = (event: React.SyntheticEvent): void => {\n    event.preventDefault();\n\n    const li = document.querySelector(`body > [data-fixed-mode-id=${ fixedModeID }] li`) as HTMLElement;\n\n    if (li?.focus) { li.focus(); }\n  };\n\n  return (\n    <>\n      <div\n        // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n        tabIndex={ 0 }\n        className={ styles.dropdown__target }\n        ref={ trackerRefCallback }\n        onFocus={ onFocusTracker }\n      />\n      {\n        portalContainerNode\n          ? createPortal(\n            <div\n              style={ dropDownStyle }\n              className={ styles.dropdown__portal }\n              data-fixed-mode-id={ fixedModeID }\n            >\n              { children }\n            </div>,\n            portalContainerNode\n          )\n          : null\n      }\n    </>\n  );\n};\n\nconst DropDown: React.FC<DropdownListProps> = ({ fixedModeID, isOpen, children }) => (\n  fixedModeID && isOpen\n    ? <FixedDropDown fixedModeID={ fixedModeID }>{ children }</FixedDropDown>\n    // eslint-disable-next-line react/jsx-no-useless-fragment\n    : <>{ children }</>\n);\n\nexport { DropDown };\n"],"names":["FixedDropDown","_a","fixedModeID","children","_b","useState","dropDownStyle","setDropDownStyle","_c","portalContainerNode","setPortalContainer","_d","scrollableAncestors","setScrollableAncestors","trackerElemRef","useRef","_e","trackerElem","setTrackerElem","_f","resizeObserver","setResizeObserver","onResize","useCallback","tracker","current","getBoundingClientRect","top_1","left","width","position","top","trackerRefCallback","elem","isConnected","ancestors","ancestor","loopLimit","parentElement","document","body","matches","push","observe","useEffect","unobserve","window","addEventListener","forEach","removeEventListener","observer","ResizeObserver","disconnect","React","tabIndex","className","styles","dropdown__target","ref","onFocus","event","preventDefault","li","querySelector","focus","createPortal","style","dropdown__portal","DropDown","isOpen"],"mappings":"yJAoBA,IAAMA,EAAmD,SAACC,OAAEC,gBAAaC,aACjEC,EAAoCC,IAAnCC,OAAeC,OAChBC,EAA4CH,IAA3CI,OAAqBC,OACtBC,EAAgDN,EAAwB,IAAvEO,OAAqBC,OACtBC,EAAiBC,EAA2B,MAC5CC,EAAgCX,EAA6B,MAA5DY,OAAaC,OACdC,EAAsCd,EAAgC,MAArEe,OAAgBC,OAEjBC,EAAWC,GAAY,WAC3B,IAAMC,EAAUV,EAAeW,QAC/B,GAAID,EAAS,CACL,IAAAvB,EAAuBuB,EAAQE,wBAA7BC,QAAKC,SAAMC,UACnBtB,EAAiB,CACfuB,SAAU,QACVC,MACAH,OACAC,aAGH,IAEGG,EAAqBT,GAAY,SAACU,GAItC,GAHAf,EAAee,GACfnB,EAAeW,QAAUQ,GAAQ,KAE7BA,eAAAA,EAAMC,YAAa,CAKrB,IAJA,IAAMC,EAA2B,GAC7BC,EAA+BH,EAC/BI,EAAY,IAETD,GAAYC,GACjBA,GAAa,GACbD,EAAWA,EAASE,iBAEHC,SAASC,KACxBJ,EAAW,MACFA,eAAAA,EAAUK,QAAQ,mDAC3BN,EAAUO,KAAKN,GAInBvB,EAAuBsB,GAGrBf,GAAkBa,GACpBb,EAAeuB,QAAQV,KAExB,CAACb,IAEJwB,GAAU,WACR,GAAIxB,GAAkBH,EAGpB,OAFAG,EAAeuB,QAAQ1B,GAEhB,WAAY,OAAAG,EAAeyB,UAAU5B,MAI7C,CAACG,EAAgBH,IAEpB2B,GAAU,WASR,OARAE,OAAOC,iBAAiB,SAAUzB,GAClCwB,OAAOC,iBAAiB,SAAUzB,GAClCV,EAAoBoC,SAAQ,SAAAZ,GAC1BA,EAASW,iBAAiB,SAAUzB,GAEhCF,GAAkBA,EAAeuB,QAAQP,MAGxC,WACLU,OAAOG,oBAAoB,SAAU3B,GACrCwB,OAAOG,oBAAoB,SAAU3B,GACrCV,EAAoBoC,SAAQ,SAAAZ,GAC1BA,EAASa,oBAAoB,SAAU3B,GAEnCF,GAAkBA,EAAeyB,UAAUT,SAGlD,CAACd,EAAUF,EAAgBR,IAE9BgC,GAAU,WACR,IAAMM,EAAW,IAAIC,eAAe7B,GAKpC,OAHAD,EAAkB6B,GAClBxC,EAAmB6B,SAASC,MAErB,WAAY,OAACU,EAASE,gBAC5B,CAAC9B,IAWJ,OACE+B,gCACEA,uBAEEC,SAAW,EACXC,UAAYC,EAAOC,iBACnBC,IAAM1B,EACN2B,QAfiB,SAACC,GACtBA,EAAMC,iBAEN,IAAMC,EAAKvB,SAASwB,cAAc,8BAA+B7D,WAE7D4D,eAAAA,EAAIE,QAASF,EAAGE,WAahBvD,EACIwD,EACAZ,uBACEa,MAAQ5D,EACRiD,UAAYC,EAAOW,sCACEjE,GAEnBC,GAEJM,GAEA,KAIZ,EAEM2D,EAAwC,SAACnE,OAAEC,gBAAamE,WAAQlE,aAAe,OACnFD,GAAemE,EACXhB,gBAACrD,GAAcE,YAAcA,GAAgBC,GAE7CkD,gCAAIlD,EAJ2E"}