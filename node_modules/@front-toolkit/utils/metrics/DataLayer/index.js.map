{"version":3,"file":"index.js","sources":["../../../src/metrics/DataLayer/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport isSSR from '../../misc/isSSR';\n\nexport type WindowWithDataLayer = typeof window & { dataLayer: any[] };\n\n/**\n* A wrapper class for window.dataLayer used for sending data to Google Tag Manager.\n*/\nexport class DataLayer {\n  /**\n   * Checks the validity of the reference currently stored in mDataLayer.\n   */\n  public get inSync(): boolean {\n    return isSSR\n      ? false\n      : this.mDataLayer === (window as WindowWithDataLayer).dataLayer;\n  }\n\n  /**\n   * An instance of DataLayer.\n   */\n  private static instance: DataLayer;\n\n  /**\n   * A reference to window.dataLayer object.\n   */\n  private mDataLayer?: any[];\n\n  private constructor() {\n    this.init();\n  }\n\n  public static getInstance(): DataLayer {\n    if (!DataLayer.instance) {\n      DataLayer.instance = new DataLayer();\n    }\n\n    return DataLayer.instance;\n  }\n\n  /**\n   * Sets mDataLayer to reference window.dataLayer.\n   * @remarks\n   * mDataLayer remains undefined on server in ssr environments.\n   */\n  public init(): void {\n    if (!isSSR) {\n      this.mDataLayer = (window as WindowWithDataLayer).dataLayer;\n\n      if (!this.mDataLayer) {\n        console.warn('window.dataLayer is not initialized. Please, check whether the GTM init script is present on the page.');\n      }\n    }\n  }\n\n  /**\n   * Adds an object to dataLayer.\n   *\n   * @remarks\n   * - Before usage, GTM container should be initialized in the target project and should not be re-initialized later.\n   * https://developers.google.com/tag-platform/tag-manager/web\n   *\n   * - Does nothing when run on server in ssr environments.\n   * @param obj {Object} - an object, which holds events or variables to be passed to Google Tag Manager via dataLayer.\n   */\n  public push(obj: any): void {\n    if (!this.mDataLayer || !this.inSync) {\n      this.init(); // try to resync mDataLayer with window.dataLayer\n    }\n\n    this.mDataLayer?.push(obj);\n  }\n}\n"],"names":["DataLayer","this","init","Object","defineProperty","prototype","get","isSSR","mDataLayer","window","dataLayer","getInstance","instance","console","warn","push","obj","inSync","_a"],"mappings":"yCAQA,IAAAA,EAAA,WAoBE,SAAAA,IACEC,KAAKC,OA2CT,OA5DEC,OAAAC,eAAWJ,EAAMK,UAAA,SAAA,CAAjBC,IAAA,WACE,OAAOC,GAEHN,KAAKO,aAAgBC,OAA+BC,2CAiB5CV,EAAAW,YAAd,WAKE,OAJKX,EAAUY,WACbZ,EAAUY,SAAW,IAAIZ,GAGpBA,EAAUY,UAQZZ,EAAAK,UAAAH,KAAP,WACOK,IACHN,KAAKO,WAAcC,OAA+BC,UAE7CT,KAAKO,YACRK,QAAQC,KAAK,4GAeZd,EAAIK,UAAAU,KAAX,SAAYC,SACLf,KAAKO,YAAeP,KAAKgB,QAC5BhB,KAAKC,OAGQ,QAAfgB,EAAAjB,KAAKO,kBAAU,IAAAU,GAAAA,EAAEH,KAAKC,IAEzBhB"}